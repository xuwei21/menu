<!-- pages/order/order.wxml -->
<view class="order-container">
  <!-- 订单内容 -->
  <scroll-view scroll-y class="order-content" style="height: {{scrollHeight}}px;">
    <view wx:if="{{selectedDishes.length > 0}}" class="dishes-list">
      <view wx:for="{{selectedDishes}}" wx:key="id" class="order-dish-item">
        <image src="{{item.image}}" mode="aspectFill" class="dish-image"></image>
        <view class="dish-content">
          <text class="dish-name">{{item.name}}</text>
          <view class="dish-bottom">
            <text class="dish-price">{{item.price}} 🕐</text>
            <view class="quantity-control">
              <button class="btn-minus" bindtap="decreaseQuantity" data-id="{{item.id}}">-</button>
              <text class="quantity">{{item.quantity}}</text>
              <button class="btn-plus" bindtap="increaseQuantity" data-id="{{item.id}}">+</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view wx:else class="empty-order">
      <view class="empty-icon">📋</view>
      <text class="empty-text">🍔 🍕 🍜 🍤 🍰</text>
      <button class="order-btn" bindtap="goToMenu">看看菜单吧</button>
    </view>

    <!-- 添加底部占位，防止内容被底部栏遮挡 -->
    <view wx:if="{{selectedDishes.length > 0}}" class="bottom-placeholder" style="height: {{footerHeight}}px;"></view>
  </scroll-view>

  <!-- 底部结算栏 -->
  <view wx:if="{{selectedDishes.length > 0}}" class="order-footer">
    <view class="total-info">
      <text class="total-count">共 {{totalCount}} 道菜</text>
      <text class="total-price">时间: {{totalPrice}} 🕐</text>
    </view>
    <button class="checkout-btn" bindtap="onCheckout" disabled="{{isGettingUserInfo}}">
      {{isGettingUserInfo ? '等待中...' : '告诉梦猫人吧 🍽️'}}
    </button>
  </view>

  <!-- 优化后的用户信息弹窗 -->
  <view wx:if="{{showNicknameModal}}" class="modal-mask" bindtap="cancelUserInfo">
    <view class="modal-content" catchtap="noop">
      <view class="modal-header">
        <text class="modal-title">Who are you❓</text>
        <text class="modal-subtitle">告诉梦猫人👩🏻‍🍳 你是谁吧</text>
      </view>
      
      <view class="modal-body">
        <!-- 头像选择区域 -->
        <view class="form-section">
          <!-- <text class="form-label">头像</text> -->
          <button class="avatar-upload-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <view class="avatar-container">
              <image wx:if="{{tempAvatarUrl}}" src="{{tempAvatarUrl}}" class="avatar-image"></image>
              <view wx:else class="avatar-placeholder">
                <text class="avatar-icon">👤</text>
                <text class="avatar-text">点击选择</text>
              </view>
              <view class="avatar-overlay">
                <text class="camera-icon"></text>
              </view>
            </view>
          </button>
        </view>

        <!-- 昵称输入区域 -->
        <view class="form-section">
          <!-- <text class="form-label">昵称</text> -->
          <view class="input-container">
            <input 
              type="nickname" 
              class="nickname-input" 
              placeholder="👉🏻填一下昵称" 
              value="{{tempNickName}}"
              bindinput="onNicknameInput"
              placeholder-class="input-placeholder"
            />
            <!-- <view class="input-clear" wx:if="{{tempNickName}}" bindtap="clearNickname">
              <text class="clear-icon">×</text>
            </view> -->
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn-cancel" bindtap="cancelUserInfo">取消</button>
        <button class="btn-confirm" bindtap="confirmUserInfo" disabled="{{!tempNickName }}">
          确认
        </button>
      </view>
    </view>
  </view>
</view>