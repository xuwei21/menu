<!-- pages/order/orderlist.wxml -->
<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <view class="title">点餐记录</view>
  </view>

  <!-- 订单列表 -->
  <scroll-view class="order-list" scroll-y refresher-enabled="{{true}}" refresher-triggered="{{refreshing}}" bindrefresherrefresh="onPullDownRefresh">
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{orders.length === 0 && !loading}}">
      <text class="empty-text">没有点餐记录</text>
      <text class="empty-desc">约好友来吃饭吧</text>
    </view>

    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{loading && orders.length === 0}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 订单项 -->
    <view class="order-item" wx:for="{{orders}}" wx:key="_id" data-order="{{item}}" bindtap="navigateToDetail">
      <view class="order-header">
        <view class="customer-name">{{item.nickName}}</view>
        <view class="order-time">{{item.time}}</view>
      </view>
      
      <view class="dishes-list">
        <text class="dishes-label">菜品：</text>
        <text class="dishes-names">{{item.dishes}}</text>
      </view>
      
      <!-- 订单底部状态栏 -->
      <view class="order-footer">
        <view class="status-section">
          <view class="status-badge {{item.status}}">
            {{item.status === 'completed' ? '已完成' : '待处理'}}
          </view>
          <!-- <text class="status-text">
            {{item.status === 'completed' ? '订单已完成' : '等待处理中'}}
          </text> -->
        </view>
        <view class="switch-section">
          <switch 
            class="status-switch" 
            checked="{{item.status === 'completed'}}" 
            color="#FF6B6B"
            bindchange="onStatusChange"
            data-order="{{item}}"
            data-index="{{index}}"
          />
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{orders.length > 0}}">
      <text class="load-more-text" wx:if="{{loading}}">加载中...</text>
      <text class="load-more-text" wx:elif="{{!hasMore}}">没有更多订单了</text>
      <text class="load-more-text" wx:else>上拉加载更多</text>
    </view>
  </scroll-view>
</view>